---
phase: 03-retrieval-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/table.tsx
  - frontend/src/components/ui/slider.tsx
  - frontend/src/components/ui/checkbox.tsx
  - frontend/src/components/ui/select.tsx
  - frontend/src/components/ui/label.tsx
  - frontend/src/features/retrieval/hooks/useRetrieve.ts
  - frontend/src/features/retrieval/components/RetrievalForm.tsx
autonomous: true

must_haves:
  truths:
    - "User can enter a search query in a text input"
    - "User can adjust Top-K slider to control number of results"
    - "User can toggle query enhancer on/off via checkbox"
    - "User can toggle reranking on/off via checkbox"
    - "User can select pipeline type from dropdown"
    - "User can click Retrieve button to execute search"
  artifacts:
    - path: "frontend/src/features/retrieval/hooks/useRetrieve.ts"
      provides: "Retrieval mutation hook"
      exports: ["useRetrieve"]
    - path: "frontend/src/features/retrieval/components/RetrievalForm.tsx"
      provides: "Query form with parameter controls"
      exports: ["RetrievalForm"]
    - path: "frontend/src/components/ui/slider.tsx"
      provides: "Slider component for Top-K"
    - path: "frontend/src/components/ui/checkbox.tsx"
      provides: "Checkbox component for toggles"
    - path: "frontend/src/components/ui/select.tsx"
      provides: "Select component for pipeline dropdown"
  key_links:
    - from: "frontend/src/features/retrieval/hooks/useRetrieve.ts"
      to: "/retrieve"
      via: "apiClient POST"
      pattern: "apiClient.*retrieve"
    - from: "frontend/src/features/retrieval/components/RetrievalForm.tsx"
      to: "useRetrieve"
      via: "receives onSubmit prop that calls mutation"
      pattern: "onSubmit.*RetrievalRequest"
---

<objective>
Install shadcn UI components needed for retrieval testing, create the useRetrieve mutation hook, and build the RetrievalForm component with all parameter controls.

Purpose: Establish the input side of retrieval testing - form controls and API integration.
Output: Working form with query input, slider, checkboxes, dropdown, and submit button.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-retrieval-testing/03-RESEARCH.md

# Key existing files
@frontend/src/lib/api-client.ts
@frontend/src/types/api.ts
@frontend/src/features/retrieval/RetrievalPage.tsx
@frontend/src/features/chat/hooks/useSendMessage.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn components for retrieval UI</name>
  <files>
    frontend/src/components/ui/table.tsx
    frontend/src/components/ui/slider.tsx
    frontend/src/components/ui/checkbox.tsx
    frontend/src/components/ui/select.tsx
    frontend/src/components/ui/label.tsx
  </files>
  <action>
    Run shadcn CLI to add required components:
    ```bash
    cd frontend && pnpm dlx shadcn@latest add table slider checkbox select label
    ```

    These components are needed for:
    - table: Results display (used in Plan 02)
    - slider: Top-K control with value display
    - checkbox: Query enhancer and reranking toggles
    - select: Pipeline type dropdown
    - label: Form field labels with accessibility

    Verify all five component files are created in `frontend/src/components/ui/`.
  </action>
  <verify>
    All five files exist:
    ```bash
    ls frontend/src/components/ui/table.tsx frontend/src/components/ui/slider.tsx frontend/src/components/ui/checkbox.tsx frontend/src/components/ui/select.tsx frontend/src/components/ui/label.tsx
    ```
  </verify>
  <done>Five shadcn components installed and available for import</done>
</task>

<task type="auto">
  <name>Task 2: Create useRetrieve mutation hook</name>
  <files>
    frontend/src/features/retrieval/hooks/useRetrieve.ts
  </files>
  <action>
    Create hooks directory and useRetrieve.ts:

    ```typescript
    import { useMutation } from '@tanstack/react-query'
    import { apiClient } from '@/lib/api-client'
    import type { RetrievalRequest, RetrievalResponse } from '@/types/api'

    export function useRetrieve() {
      return useMutation({
        mutationFn: async (request: RetrievalRequest) => {
          return apiClient<RetrievalResponse>('/retrieve', {
            method: 'POST',
            body: request,
          })
        },
      })
    }
    ```

    Key patterns (from research):
    - Use `useMutation` for POST endpoint (NOT useQuery)
    - No cache invalidation needed (retrieval is read-only)
    - No onSuccess handler needed (UI displays result directly)
    - Use existing types from api.ts

    AVOID: Do NOT use useQuery - the /retrieve endpoint is POST and performs expensive server-side operations.
  </action>
  <verify>
    ```bash
    cd frontend && pnpm exec tsc --noEmit
    ```
    TypeScript compiles without errors.
  </verify>
  <done>useRetrieve mutation hook created following useSendMessage pattern</done>
</task>

<task type="auto">
  <name>Task 3: Create RetrievalForm component</name>
  <files>
    frontend/src/features/retrieval/components/RetrievalForm.tsx
  </files>
  <action>
    Create components directory and RetrievalForm.tsx:

    ```typescript
    import { useState } from 'react'
    import { Search, Loader2 } from 'lucide-react'
    import { Button } from '@/components/ui/button'
    import { Input } from '@/components/ui/input'
    import { Label } from '@/components/ui/label'
    import { Slider } from '@/components/ui/slider'
    import { Checkbox } from '@/components/ui/checkbox'
    import {
      Select,
      SelectContent,
      SelectItem,
      SelectTrigger,
      SelectValue,
    } from '@/components/ui/select'
    import type { PipelineType, RetrievalRequest } from '@/types/api'

    interface RetrievalFormProps {
      onSubmit: (request: RetrievalRequest) => void
      isPending: boolean
    }

    export function RetrievalForm({ onSubmit, isPending }: RetrievalFormProps) {
      const [query, setQuery] = useState('')
      const [topK, setTopK] = useState(10)
      const [useQueryEnhancer, setUseQueryEnhancer] = useState(false)
      const [useReranking, setUseReranking] = useState(false)
      const [pipelineType, setPipelineType] = useState<PipelineType>('recursive_overlap')

      const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault()
        if (!query.trim()) return

        onSubmit({
          query: query.trim(),
          top_k: topK,
          use_query_enhancer: useQueryEnhancer,
          use_reranking: useReranking,
          pipeline_type: pipelineType,
        })
      }

      return (
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Query Input */}
          <div className="space-y-2">
            <Label htmlFor="query">Search Query</Label>
            <Input
              id="query"
              placeholder="Enter your search query..."
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              disabled={isPending}
            />
          </div>

          {/* Parameter Controls */}
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Top-K Slider */}
            <div className="space-y-2">
              <div className="flex items-center justify-between">
                <Label htmlFor="top-k">Top K Results</Label>
                <span className="text-sm text-muted-foreground">{topK}</span>
              </div>
              <Slider
                id="top-k"
                min={1}
                max={50}
                step={1}
                value={[topK]}
                onValueChange={([value]) => setTopK(value)}
                disabled={isPending}
              />
            </div>

            {/* Pipeline Select */}
            <div className="space-y-2">
              <Label htmlFor="pipeline">Pipeline Type</Label>
              <Select
                value={pipelineType}
                onValueChange={(value) => setPipelineType(value as PipelineType)}
                disabled={isPending}
              >
                <SelectTrigger id="pipeline">
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="recursive_overlap">Recursive Overlap</SelectItem>
                  <SelectItem value="semantic">Semantic</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </div>

          {/* Toggle Checkboxes */}
          <div className="flex flex-wrap gap-6">
            <div className="flex items-center space-x-2">
              <Checkbox
                id="query-enhancer"
                checked={useQueryEnhancer}
                onCheckedChange={(checked) => setUseQueryEnhancer(checked === true)}
                disabled={isPending}
              />
              <Label htmlFor="query-enhancer" className="cursor-pointer">
                Enable Query Enhancer
              </Label>
            </div>

            <div className="flex items-center space-x-2">
              <Checkbox
                id="reranking"
                checked={useReranking}
                onCheckedChange={(checked) => setUseReranking(checked === true)}
                disabled={isPending}
              />
              <Label htmlFor="reranking" className="cursor-pointer">
                Enable Reranking
              </Label>
            </div>
          </div>

          {/* Submit Button */}
          <Button type="submit" disabled={isPending || !query.trim()}>
            {isPending ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                Retrieving...
              </>
            ) : (
              <>
                <Search className="mr-2 h-4 w-4" />
                Retrieve
              </>
            )}
          </Button>
        </form>
      )
    }
    ```

    Key patterns (from research):
    - Simple useState for each field (no react-hook-form needed)
    - Slider uses array format: `value={[topK]}` and destructure `onValueChange={([value]) => ...}`
    - Checkbox uses `checked === true` to handle indeterminate state
    - Button disabled when empty query or pending
    - All fields disabled during pending state

    AVOID:
    - Do NOT use react-hook-form (overkill for 5 simple controls)
    - Do NOT use single number for Slider value (must be array)
  </action>
  <verify>
    ```bash
    cd frontend && pnpm exec tsc --noEmit
    ```
    TypeScript compiles without errors.
  </verify>
  <done>RetrievalForm component created with all parameter controls (RETR-01 through RETR-06)</done>
</task>

</tasks>

<verification>
After completing all tasks:
1. `cd frontend && pnpm build` passes
2. All shadcn components installed in components/ui/
3. useRetrieve hook exports correctly
4. RetrievalForm TypeScript compiles
5. No unused imports or type errors
</verification>

<success_criteria>
- Five shadcn components installed (table, slider, checkbox, select, label)
- useRetrieve mutation hook created
- RetrievalForm component with all controls created
- Requirements RETR-01 through RETR-06 addressed (form controls + retrieve button)
- Ready for Plan 02 to add results display and integration
</success_criteria>

<output>
After completion, create `.planning/phases/03-retrieval-testing/03-01-SUMMARY.md`
</output>
