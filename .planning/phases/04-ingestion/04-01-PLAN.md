---
phase: 04-ingestion
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/ui/progress.tsx
  - frontend/src/components/ui/badge.tsx
  - frontend/src/features/ingestion/hooks/useFolders.ts
  - frontend/src/features/ingestion/hooks/useStartJob.ts
  - frontend/src/features/ingestion/components/FolderSelect.tsx
  - frontend/src/features/ingestion/components/IngestionForm.tsx
  - frontend/src/features/ingestion/IngestionPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can see available folders in a dropdown"
    - "User can refresh the folder list"
    - "User can select file types (PDF, JSON)"
    - "User can select pipeline type"
    - "User can start an ingestion job"
    - "User sees job ID after starting"
  artifacts:
    - path: "frontend/src/components/ui/progress.tsx"
      provides: "Progress bar component for later use"
    - path: "frontend/src/components/ui/badge.tsx"
      provides: "Status badge component for later use"
    - path: "frontend/src/features/ingestion/hooks/useFolders.ts"
      provides: "TanStack Query hook for /assets/list"
      exports: ["useFolders"]
    - path: "frontend/src/features/ingestion/hooks/useStartJob.ts"
      provides: "TanStack mutation for /ingestion/start_job"
      exports: ["useStartJob"]
    - path: "frontend/src/features/ingestion/components/FolderSelect.tsx"
      provides: "Folder dropdown with refresh button"
      exports: ["FolderSelect"]
    - path: "frontend/src/features/ingestion/components/IngestionForm.tsx"
      provides: "Complete job configuration form"
      exports: ["IngestionForm"]
  key_links:
    - from: "FolderSelect.tsx"
      to: "useFolders.ts"
      via: "hook consumption"
      pattern: "useFolders\\(\\)"
    - from: "IngestionPage.tsx"
      to: "useStartJob.ts"
      via: "mutation for job start"
      pattern: "useStartJob\\(\\)"
    - from: "IngestionForm.tsx"
      to: "/ingestion/start_job"
      via: "onSubmit callback"
---

<objective>
Create the ingestion job configuration form with folder selection, file type checkboxes, pipeline dropdown, and job start functionality. After submitting, the user sees the job ID immediately.

Purpose: Enables users to initiate document ingestion jobs with configurable options
Output: Working form that starts ingestion jobs and displays job ID
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-ingestion/04-CONTEXT.md
@.planning/phases/04-ingestion/04-RESEARCH.md
@frontend/src/types/api.ts
@frontend/src/lib/api-client.ts
@frontend/src/features/retrieval/RetrievalPage.tsx
@frontend/src/features/retrieval/components/RetrievalForm.tsx
@frontend/src/features/retrieval/hooks/useRetrieve.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn components and create API hooks</name>
  <files>
    frontend/src/components/ui/progress.tsx
    frontend/src/components/ui/badge.tsx
    frontend/src/features/ingestion/hooks/useFolders.ts
    frontend/src/features/ingestion/hooks/useStartJob.ts
  </files>
  <action>
1. Install shadcn progress and badge components:
   ```bash
   cd frontend && pnpm dlx shadcn@latest add progress badge
   ```

2. Create `frontend/src/features/ingestion/hooks/useFolders.ts`:
   - Use `useQuery` with queryKey `['assets', 'folders']`
   - Call `apiClient<AssetsListResponse>('/assets/list')`
   - Import types from `@/types/api`
   - Follow pattern from existing hooks (useRetrieve, useSessions)

3. Create `frontend/src/features/ingestion/hooks/useStartJob.ts`:
   - Use `useMutation` for POST `/ingestion/start_job`
   - Accept `IngestionJobRequest` as parameter
   - Return `IngestionJobResponse`
   - In `onSuccess`, invalidate `['ingestion', 'jobs']` query
   - Follow pattern from useRetrieve.ts
  </action>
  <verify>
    - `ls frontend/src/components/ui/progress.tsx` exists
    - `ls frontend/src/components/ui/badge.tsx` exists
    - TypeScript compiles: `cd frontend && pnpm tsc --noEmit`
  </verify>
  <done>
    shadcn components installed, useFolders and useStartJob hooks created with proper types
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FolderSelect and IngestionForm components</name>
  <files>
    frontend/src/features/ingestion/components/FolderSelect.tsx
    frontend/src/features/ingestion/components/IngestionForm.tsx
  </files>
  <action>
1. Create `frontend/src/features/ingestion/components/FolderSelect.tsx`:
   - Props: `value: string`, `onChange: (value: string) => void`, `disabled?: boolean`
   - Use `useFolders` hook to populate options
   - Select component with folder name and file count: `{folder.name} ({folder.file_count} files)`
   - Refresh button next to select that calls `refetch()`
   - Show spinner icon on button when `isFetching`
   - Use lucide-react `RefreshCw` icon with `animate-spin` class when fetching

2. Create `frontend/src/features/ingestion/components/IngestionForm.tsx`:
   - Props: `onSubmit: (request: IngestionJobRequest) => void`, `isPending: boolean`
   - State: `folderPath`, `includePdf` (default true), `includeJson` (default false), `pipelineType` (default 'recursive_overlap')
   - Layout following RetrievalForm pattern:
     - FolderSelect for folder selection
     - Two checkboxes for file types (PDF, JSON)
     - Select dropdown for pipeline type
     - Submit button with "Start Ingestion" text and Play icon
   - Validation:
     - Disable submit if no folder selected
     - Disable submit if no file types selected (show error text)
     - Use `useFolders` to check selected folder's file_count - show warning if 0
   - Build `file_types` array from checkbox states (e.g., ['pdf'] or ['pdf', 'json'])
   - Show warning with AlertTriangle icon if selected folder has 0 files
  </action>
  <verify>
    TypeScript compiles: `cd frontend && pnpm tsc --noEmit`
  </verify>
  <done>
    FolderSelect shows folders with refresh, IngestionForm has all configuration options with validation
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate form into IngestionPage with job ID display</name>
  <files>
    frontend/src/features/ingestion/IngestionPage.tsx
  </files>
  <action>
1. Update `frontend/src/features/ingestion/IngestionPage.tsx`:
   - Add state: `currentJobId: string | null` (useState, initially null)
   - Use `useStartJob` mutation hook
   - Create `handleSubmit` function:
     - Call `startJob.mutate(request)`
     - On success (via mutation's onSuccess or data check), set `currentJobId` from response
   - Layout structure (follow RetrievalPage pattern):
     - Header with title "Ingestion" and description "Ingest documents into the system"
     - Card containing IngestionForm
     - Below form (inside card or separate): Show job ID when `currentJobId` exists
       - Display as: "Job started: {job_id}" with CheckCircle icon
       - Use `font-mono text-sm` for job ID display
   - Error state: Show error banner if mutation fails (follow RetrievalPage pattern)
  </action>
  <verify>
    - `cd frontend && pnpm build` succeeds
    - Start dev server and visit Ingestion tab - form renders
    - Folder dropdown shows options from /assets/list
    - Can start job (with backend running) and see job ID
  </verify>
  <done>
    User can select folder, configure options, start job, and see job ID immediately
  </done>
</task>

</tasks>

<verification>
- All TypeScript compiles without errors
- Ingestion form renders with all required fields
- Folder dropdown populates from API
- Refresh button reloads folder list
- Start button is disabled until folder and file type selected
- Job ID displays after successful job start
</verification>

<success_criteria>
- INGE-01: Folder dropdown populated from assets API
- INGE-02: Refresh button reloads folder list
- INGE-03: File type checkboxes (PDF, JSON) present
- INGE-04: Pipeline type dropdown present
- INGE-05: Start ingestion button triggers job
- INGE-06: Job ID displayed after job starts
</success_criteria>

<output>
After completion, create `.planning/phases/04-ingestion/04-01-SUMMARY.md`
</output>
