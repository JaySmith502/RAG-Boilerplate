---
phase: 02-chat
plan: 04
type: gap-closure
wave: 1
depends_on: []
files_modified:
  - frontend/src/features/chat/ChatPage.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking New Chat clears any text in the message input"
  artifacts:
    - path: "frontend/src/features/chat/ChatPage.tsx"
      provides: "MessageInput with key prop for session reset"
      contains: "key={selectedSessionId"
---

<objective>
Fix New Chat button to clear input text

Purpose: When user clicks "New Chat" button, the message input should reset to empty. Currently the input text persists because MessageInput's local state isn't reset when the session changes.

Output: MessageInput renders with a key prop based on selectedSessionId, forcing React to remount and reset state on session change.
</objective>

<context>
**Gap from UAT:** Test 3 - New Chat button doesn't clear input text
**Root cause:** MessageInput has local useState for message text that persists across session changes.
**Fix:** Add `key` prop to force remount when session changes.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add key prop to MessageInput for session reset</name>
  <files>
    frontend/src/features/chat/ChatPage.tsx
  </files>
  <action>
    In ChatPage.tsx, update the MessageInput component to include a key prop:

    Change from:
    ```tsx
    <MessageInput
      onSend={handleSend}
      disabled={isSending}
      placeholder={isSending ? 'Sending...' : 'Type a message...'}
    />
    ```

    To:
    ```tsx
    <MessageInput
      key={selectedSessionId ?? 'new'}
      onSend={handleSend}
      disabled={isSending}
      placeholder={isSending ? 'Sending...' : 'Type a message...'}
    />
    ```

    This causes React to unmount and remount MessageInput when selectedSessionId changes, resetting its internal state.
  </action>
  <verify>
    Run `cd frontend && pnpm build` - should pass.
    Manual: Type text in input, click New Chat - input should clear.
  </verify>
  <done>
    MessageInput resets when session changes via key prop.
  </done>
</task>

</tasks>

<verification>
After task complete:

1. **Build check:**
   ```bash
   cd frontend && pnpm build
   ```
   Build passes.

2. **Manual check:**
   - Type some text in the message input
   - Click the "New Chat" button
   - The input should be empty
</verification>

<success_criteria>
- MessageInput has key prop based on selectedSessionId
- Build passes
- Input clears when New Chat is clicked
</success_criteria>
