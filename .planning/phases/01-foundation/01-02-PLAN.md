---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - frontend/index.html
  - frontend/src/providers/theme-provider.tsx
  - frontend/src/components/layout/mode-toggle.tsx
  - frontend/src/components/layout/app-sidebar.tsx
  - frontend/src/components/layout/header.tsx
  - frontend/src/components/layout/page-container.tsx
  - frontend/src/App.tsx
  - frontend/src/features/chat/ChatPage.tsx
  - frontend/src/features/retrieval/RetrievalPage.tsx
  - frontend/src/features/ingestion/IngestionPage.tsx
  - frontend/src/features/evaluation/EvaluationPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between Light, Dark, and System theme modes"
    - "Theme preference persists in localStorage across page refresh"
    - "Page loads without flash of wrong theme (no FOUC)"
    - "User sees sidebar with navigation icons for Chat, Retrieval, Ingestion, Evaluation"
    - "Clicking a nav item shows the corresponding page content"
    - "Header displays application title and theme toggle"
  artifacts:
    - path: "frontend/index.html"
      provides: "FOUC prevention inline script"
      contains: "vite-ui-theme"
    - path: "frontend/src/providers/theme-provider.tsx"
      provides: "Theme context and useTheme hook"
      exports: ["ThemeProvider", "useTheme"]
    - path: "frontend/src/components/layout/app-sidebar.tsx"
      provides: "Linear-style navigation sidebar"
      contains: "MessageSquare"
    - path: "frontend/src/components/layout/header.tsx"
      provides: "Header with title and theme toggle"
      contains: "ModeToggle"
  key_links:
    - from: "frontend/index.html"
      to: "localStorage"
      via: "inline script before CSS loads"
      pattern: "localStorage\\.getItem.*vite-ui-theme"
    - from: "frontend/src/components/layout/mode-toggle.tsx"
      to: "frontend/src/providers/theme-provider.tsx"
      via: "useTheme hook"
      pattern: "useTheme\\(\\)"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/providers/theme-provider.tsx"
      via: "Provider wrapping"
      pattern: "ThemeProvider"
---

<objective>
Implement theme system with FOUC prevention and create the layout shell with sidebar navigation

Purpose: Establish the visual foundation and navigation structure. The theme system ensures consistent light/dark mode experience without flash, and the layout shell provides the skeleton that all feature pages will render within.

Output: Working theme toggle (Light/Dark/System), persistent theme preference, FOUC-free page loads, sidebar with navigation to 4 placeholder pages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FOUC prevention script and create ThemeProvider</name>
  <files>
    frontend/index.html
    frontend/src/providers/theme-provider.tsx
  </files>
  <action>
    Implement theme system with FOUC prevention:

    1. Update frontend/index.html to add inline FOUC prevention script in head BEFORE any CSS:
       ```html
       <!doctype html>
       <html lang="en">
         <head>
           <meta charset="UTF-8" />
           <meta name="viewport" content="width=device-width, initial-scale=1.0" />
           <title>RAG Dashboard</title>
           <!-- FOUC Prevention: Apply theme BEFORE any CSS loads -->
           <script>
             (function() {
               const storageKey = 'vite-ui-theme';
               const theme = localStorage.getItem(storageKey);

               if (theme === 'dark') {
                 document.documentElement.classList.add('dark');
               } else if (theme === 'light') {
                 document.documentElement.classList.remove('dark');
               } else {
                 // System preference (default)
                 if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                   document.documentElement.classList.add('dark');
                 }
               }
             })();
           </script>
         </head>
         <body>
           <div id="root"></div>
           <script type="module" src="/src/main.tsx"></script>
         </body>
       </html>
       ```

    2. Create frontend/src/providers/theme-provider.tsx with React context:
       ```typescript
       import { createContext, useContext, useEffect, useState } from "react"

       type Theme = "dark" | "light" | "system"

       type ThemeProviderProps = {
         children: React.ReactNode
         defaultTheme?: Theme
         storageKey?: string
       }

       type ThemeProviderState = {
         theme: Theme
         setTheme: (theme: Theme) => void
       }

       const initialState: ThemeProviderState = {
         theme: "system",
         setTheme: () => null,
       }

       const ThemeProviderContext = createContext<ThemeProviderState>(initialState)

       export function ThemeProvider({
         children,
         defaultTheme = "system",
         storageKey = "vite-ui-theme",
         ...props
       }: ThemeProviderProps) {
         const [theme, setTheme] = useState<Theme>(
           () => (localStorage.getItem(storageKey) as Theme) || defaultTheme
         )

         useEffect(() => {
           const root = window.document.documentElement
           root.classList.remove("light", "dark")

           if (theme === "system") {
             const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
               .matches
               ? "dark"
               : "light"
             root.classList.add(systemTheme)
             return
           }

           root.classList.add(theme)
         }, [theme])

         const value = {
           theme,
           setTheme: (theme: Theme) => {
             localStorage.setItem(storageKey, theme)
             setTheme(theme)
           },
         }

         return (
           <ThemeProviderContext.Provider {...props} value={value}>
             {children}
           </ThemeProviderContext.Provider>
         )
       }

       export const useTheme = () => {
         const context = useContext(ThemeProviderContext)
         if (context === undefined)
           throw new Error("useTheme must be used within a ThemeProvider")
         return context
       }
       ```

    Key points:
    - Storage key matches between inline script and React provider ("vite-ui-theme")
    - useEffect syncs React state with DOM class
    - System theme listens to OS preference
  </action>
  <verify>
    Check that frontend/index.html has the inline script in head.
    Check that frontend/src/providers/theme-provider.tsx exports ThemeProvider and useTheme.
    Run `cd frontend && pnpm tsc --noEmit` - no type errors.
  </verify>
  <done>
    FOUC prevention script in index.html, ThemeProvider context created with useTheme hook exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create layout components (ModeToggle, Header, Sidebar, PageContainer)</name>
  <files>
    frontend/src/components/layout/mode-toggle.tsx
    frontend/src/components/layout/header.tsx
    frontend/src/components/layout/app-sidebar.tsx
    frontend/src/components/layout/page-container.tsx
  </files>
  <action>
    Create the layout shell components:

    1. Create frontend/src/components/layout/mode-toggle.tsx:
       ```typescript
       import { Moon, Sun } from "lucide-react"
       import { Button } from "@/components/ui/button"
       import {
         DropdownMenu,
         DropdownMenuContent,
         DropdownMenuItem,
         DropdownMenuTrigger,
       } from "@/components/ui/dropdown-menu"
       import { useTheme } from "@/providers/theme-provider"

       export function ModeToggle() {
         const { setTheme } = useTheme()

         return (
           <DropdownMenu>
             <DropdownMenuTrigger asChild>
               <Button variant="outline" size="icon">
                 <Sun className="h-[1.2rem] w-[1.2rem] scale-100 rotate-0 transition-all dark:scale-0 dark:-rotate-90" />
                 <Moon className="absolute h-[1.2rem] w-[1.2rem] scale-0 rotate-90 transition-all dark:scale-100 dark:rotate-0" />
                 <span className="sr-only">Toggle theme</span>
               </Button>
             </DropdownMenuTrigger>
             <DropdownMenuContent align="end">
               <DropdownMenuItem onClick={() => setTheme("light")}>
                 Light
               </DropdownMenuItem>
               <DropdownMenuItem onClick={() => setTheme("dark")}>
                 Dark
               </DropdownMenuItem>
               <DropdownMenuItem onClick={() => setTheme("system")}>
                 System
               </DropdownMenuItem>
             </DropdownMenuContent>
           </DropdownMenu>
         )
       }
       ```

    2. Create frontend/src/components/layout/header.tsx:
       ```typescript
       import { ModeToggle } from "./mode-toggle"

       export function Header() {
         return (
           <header className="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
             <div className="flex h-14 items-center px-4">
               <div className="flex-1">
                 <h1 className="text-lg font-semibold">RAG Dashboard</h1>
               </div>
               <div className="flex items-center gap-2">
                 <ModeToggle />
               </div>
             </div>
           </header>
         )
       }
       ```

    3. Create frontend/src/components/layout/app-sidebar.tsx using shadcn sidebar:
       ```typescript
       import { MessageSquare, Search, Upload, BarChart } from "lucide-react"
       import {
         Sidebar,
         SidebarContent,
         SidebarGroup,
         SidebarGroupContent,
         SidebarGroupLabel,
         SidebarMenu,
         SidebarMenuButton,
         SidebarMenuItem,
       } from "@/components/ui/sidebar"

       const navItems = [
         { title: "Chat", icon: MessageSquare, id: "chat" },
         { title: "Retrieval", icon: Search, id: "retrieval" },
         { title: "Ingestion", icon: Upload, id: "ingestion" },
         { title: "Evaluation", icon: BarChart, id: "evaluation" },
       ]

       interface AppSidebarProps {
         activeSection: string
         onSectionChange: (section: string) => void
       }

       export function AppSidebar({ activeSection, onSectionChange }: AppSidebarProps) {
         return (
           <Sidebar>
             <SidebarContent>
               <SidebarGroup>
                 <SidebarGroupLabel>Navigation</SidebarGroupLabel>
                 <SidebarGroupContent>
                   <SidebarMenu>
                     {navItems.map((item) => (
                       <SidebarMenuItem key={item.id}>
                         <SidebarMenuButton
                           isActive={activeSection === item.id}
                           onClick={() => onSectionChange(item.id)}
                         >
                           <item.icon className="h-4 w-4" />
                           <span>{item.title}</span>
                         </SidebarMenuButton>
                       </SidebarMenuItem>
                     ))}
                   </SidebarMenu>
                 </SidebarGroupContent>
               </SidebarGroup>
             </SidebarContent>
           </Sidebar>
         )
       }
       ```

    4. Create frontend/src/components/layout/page-container.tsx:
       ```typescript
       import { cn } from "@/lib/utils"

       interface PageContainerProps {
         children: React.ReactNode
         fullWidth?: boolean
         className?: string
       }

       export function PageContainer({
         children,
         fullWidth = false,
         className,
       }: PageContainerProps) {
         return (
           <main
             className={cn(
               "flex-1 overflow-auto p-6",
               !fullWidth && "max-w-5xl mx-auto",
               className
             )}
           >
             {children}
           </main>
         )
       }
       ```

    Design decisions (from CONTEXT.md):
    - Header: floating bar with subtle blur effect
    - Content width: fullWidth prop for Chat (which needs full width), max-width container for others (Notion-style)
    - Navigation: Linear-style vertical nav with icons + labels
    - Active state: uses shadcn SidebarMenuButton isActive prop
  </action>
  <verify>
    Check all 4 files exist in frontend/src/components/layout/:
    - mode-toggle.tsx
    - header.tsx
    - app-sidebar.tsx
    - page-container.tsx
    Run `cd frontend && pnpm tsc --noEmit` - no type errors.
  </verify>
  <done>
    All layout components created: ModeToggle dropdown, Header with title and theme toggle, AppSidebar with 4 nav items, PageContainer with optional fullWidth.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create placeholder pages and assemble App with layout</name>
  <files>
    frontend/src/features/chat/ChatPage.tsx
    frontend/src/features/retrieval/RetrievalPage.tsx
    frontend/src/features/ingestion/IngestionPage.tsx
    frontend/src/features/evaluation/EvaluationPage.tsx
    frontend/src/App.tsx
    frontend/src/main.tsx
  </files>
  <action>
    Create placeholder pages and assemble the full layout:

    1. Create placeholder page components (these will be expanded in later phases):

       frontend/src/features/chat/ChatPage.tsx:
       ```typescript
       import { PageContainer } from "@/components/layout/page-container"

       export function ChatPage() {
         return (
           <PageContainer fullWidth>
             <div className="flex flex-col items-center justify-center h-full min-h-[400px]">
               <h2 className="text-2xl font-semibold mb-2">Chat</h2>
               <p className="text-muted-foreground">Chat interface coming in Phase 2</p>
             </div>
           </PageContainer>
         )
       }
       ```

       frontend/src/features/retrieval/RetrievalPage.tsx:
       ```typescript
       import { PageContainer } from "@/components/layout/page-container"

       export function RetrievalPage() {
         return (
           <PageContainer>
             <h2 className="text-2xl font-semibold mb-2">Retrieval Testing</h2>
             <p className="text-muted-foreground">Retrieval testing coming in Phase 3</p>
           </PageContainer>
         )
       }
       ```

       frontend/src/features/ingestion/IngestionPage.tsx:
       ```typescript
       import { PageContainer } from "@/components/layout/page-container"

       export function IngestionPage() {
         return (
           <PageContainer>
             <h2 className="text-2xl font-semibold mb-2">Ingestion</h2>
             <p className="text-muted-foreground">Document ingestion coming in Phase 4</p>
           </PageContainer>
         )
       }
       ```

       frontend/src/features/evaluation/EvaluationPage.tsx:
       ```typescript
       import { PageContainer } from "@/components/layout/page-container"

       export function EvaluationPage() {
         return (
           <PageContainer>
             <h2 className="text-2xl font-semibold mb-2">Evaluation</h2>
             <p className="text-muted-foreground">Evaluation dashboard coming in Phase 5</p>
           </PageContainer>
         )
       }
       ```

    2. Update frontend/src/App.tsx to assemble the full layout:
       ```typescript
       import { useState } from "react"
       import { ThemeProvider } from "@/providers/theme-provider"
       import { SidebarProvider } from "@/components/ui/sidebar"
       import { AppSidebar } from "@/components/layout/app-sidebar"
       import { Header } from "@/components/layout/header"
       import { ChatPage } from "@/features/chat/ChatPage"
       import { RetrievalPage } from "@/features/retrieval/RetrievalPage"
       import { IngestionPage } from "@/features/ingestion/IngestionPage"
       import { EvaluationPage } from "@/features/evaluation/EvaluationPage"
       import { Toaster } from "@/components/ui/sonner"

       function AppContent() {
         const [activeSection, setActiveSection] = useState("chat")

         const renderPage = () => {
           switch (activeSection) {
             case "chat":
               return <ChatPage />
             case "retrieval":
               return <RetrievalPage />
             case "ingestion":
               return <IngestionPage />
             case "evaluation":
               return <EvaluationPage />
             default:
               return <ChatPage />
           }
         }

         return (
           <SidebarProvider>
             <div className="flex min-h-screen w-full">
               <AppSidebar
                 activeSection={activeSection}
                 onSectionChange={setActiveSection}
               />
               <div className="flex flex-1 flex-col">
                 <Header />
                 {renderPage()}
               </div>
             </div>
             <Toaster position="bottom-right" />
           </SidebarProvider>
         )
       }

       function App() {
         return (
           <ThemeProvider defaultTheme="system" storageKey="vite-ui-theme">
             <AppContent />
           </ThemeProvider>
         )
       }

       export default App
       ```

    3. Ensure main.tsx imports index.css:
       ```typescript
       import React from 'react'
       import ReactDOM from 'react-dom/client'
       import App from './App.tsx'
       import './index.css'

       ReactDOM.createRoot(document.getElementById('root')!).render(
         <React.StrictMode>
           <App />
         </React.StrictMode>,
       )
       ```

    Key implementation notes:
    - ThemeProvider wraps everything for theme context
    - SidebarProvider from shadcn wraps the layout for sidebar functionality
    - State-based navigation (later phases may add URL routing)
    - Toaster positioned bottom-right per CONTEXT.md
  </action>
  <verify>
    Run `cd frontend && pnpm dev` and verify:
    1. App loads with sidebar on left, header on top, content area
    2. Click each nav item (Chat, Retrieval, Ingestion, Evaluation) - content changes
    3. Theme toggle works - Light/Dark/System options change appearance
    4. Set theme to Dark, refresh page - should load in dark mode without flash
    5. Set theme to Light, refresh page - should load in light mode without flash

    Run `cd frontend && pnpm tsc --noEmit` - no type errors
  </verify>
  <done>
    Full layout shell assembled with sidebar navigation, header with theme toggle, and 4 placeholder pages. Theme persists and loads without FOUC.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **FOUC Test:**
   - Set theme to Dark, hard refresh (Ctrl+Shift+R) - page should appear dark immediately, no white flash
   - Set theme to Light, hard refresh - page should appear light immediately, no dark flash
   - Clear localStorage, set OS to dark mode, refresh - should respect system preference

2. **Theme Persistence Test:**
   - Toggle to Dark, close browser, reopen - should still be dark
   - Toggle to Light, navigate away, come back - should still be light

3. **Navigation Test:**
   - Click each sidebar item: Chat, Retrieval, Ingestion, Evaluation
   - Verify active state styling on current nav item
   - Verify correct placeholder content displays

4. **Layout Structure:**
   - Sidebar visible on left with icons and labels
   - Header at top with "RAG Dashboard" title and theme toggle
   - Content area fills remaining space
   - Chat page uses full width, other pages have max-width container
</verification>

<success_criteria>
- FOUN-03: Light/dark mode toggle with theme persisted to localStorage (theme dropdown works, preference survives refresh)
- FOUN-04: No flash of unstyled content on page load (inline script prevents FOUC)
- FOUN-05: Layout shell with sidebar, header, and page container (all components render correctly)
- FOUN-06: Tab navigation between Chat, Retrieval, Ingestion, Evaluation sections (clicking nav items switches content)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md` using the summary template.
</output>
