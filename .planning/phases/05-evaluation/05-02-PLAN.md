---
phase: 05-evaluation
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/features/evaluation/components/EvaluationSelect.tsx
  - frontend/src/features/evaluation/components/EvaluationStatusBadge.tsx
  - frontend/src/features/evaluation/components/ResultsDisplay.tsx
  - frontend/src/features/evaluation/components/EvaluationsSkeleton.tsx
  - frontend/src/features/evaluation/EvaluationPage.tsx
autonomous: true

must_haves:
  truths:
    - "User can select a completed evaluation from dropdown"
    - "User can see metrics (hit rate, MRR, avg score) for selected evaluation"
    - "User can see configuration used (top-k, enhancer, reranking) alongside results"
    - "User sees loading skeleton while results fetch"
  artifacts:
    - path: "frontend/src/features/evaluation/components/EvaluationSelect.tsx"
      provides: "Dropdown to select completed evaluation"
      exports: ["EvaluationSelect"]
    - path: "frontend/src/features/evaluation/components/EvaluationStatusBadge.tsx"
      provides: "Status badge for evaluation state"
      exports: ["EvaluationStatusBadge"]
    - path: "frontend/src/features/evaluation/components/ResultsDisplay.tsx"
      provides: "Metrics cards and config display"
      exports: ["ResultsDisplay"]
    - path: "frontend/src/features/evaluation/components/EvaluationsSkeleton.tsx"
      provides: "Loading skeleton for results"
      exports: ["EvaluationsSkeleton"]
  key_links:
    - from: "frontend/src/features/evaluation/components/ResultsDisplay.tsx"
      to: "useEvaluation hook"
      via: "fetches evaluation details"
      pattern: "useEvaluation\\(evaluationId\\)"
    - from: "frontend/src/features/evaluation/EvaluationPage.tsx"
      to: "ResultsDisplay"
      via: "renders with selected evaluation ID"
      pattern: "<ResultsDisplay.*evaluationId"
---

<objective>
Create the results display section showing metrics and configuration for a selected evaluation.

Purpose: Users need to view evaluation outcomes (hit rate, MRR, avg score) alongside the configuration used (top-k, enhancer, reranking) to understand how different settings affect retrieval quality.

Output: EvaluationSelect dropdown, ResultsDisplay with metric cards and config display, EvaluationStatusBadge, and loading skeleton.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-evaluation/05-RESEARCH.md
@.planning/phases/05-evaluation/05-01-SUMMARY.md

# Existing patterns
@frontend/src/features/ingestion/components/JobStatusBadge.tsx
@frontend/src/features/ingestion/components/JobHistorySkeleton.tsx
@frontend/src/types/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EvaluationStatusBadge and EvaluationSelect components</name>
  <files>
    frontend/src/features/evaluation/components/EvaluationStatusBadge.tsx
    frontend/src/features/evaluation/components/EvaluationSelect.tsx
  </files>
  <action>
Create two components following existing badge and select patterns:

1. `EvaluationStatusBadge.tsx`:
   - Props: `status: string`
   - Use shadcn Badge component
   - Status config mapping:
     - `pending`: variant "outline", label "Pending"
     - `running`: variant "default", label "Running"
     - `completed`: variant "secondary" with `className="bg-green-500 hover:bg-green-500/80 text-white"`, label "Completed"
     - `failed`: variant "destructive", label "Failed"
   - Fallback for unknown status: variant "outline", use status as label
   - Follow exact pattern from JobStatusBadge.tsx

2. `EvaluationSelect.tsx` (EVAL-09):
   - Props: `value: string | null`, `onChange: (value: string | null) => void`, `evaluations: EvaluationStatusResponse[]`, `disabled?: boolean`
   - Use shadcn Select component
   - Show completed evaluations only, plus "no selection" option
   - Display format: `{evaluation_id.slice(0, 8)}... - {folder_path} - Hit: {hit_rate formatted}%`
   - Show EvaluationStatusBadge inline if needed, or just filter to completed
   - Handle empty state: "No evaluations available"
   - Convert empty string to null on change
  </action>
  <verify>
Files exist and TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
EvaluationStatusBadge renders colored badges for all status types. EvaluationSelect shows completed evaluations with folder and hit rate preview.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ResultsDisplay and EvaluationsSkeleton components</name>
  <files>
    frontend/src/features/evaluation/components/ResultsDisplay.tsx
    frontend/src/features/evaluation/components/EvaluationsSkeleton.tsx
  </files>
  <action>
Create results display with metrics cards and config section:

1. `EvaluationsSkeleton.tsx`:
   - Use shadcn Skeleton component
   - Create loading placeholder matching ResultsDisplay layout:
     - 3 metric card skeletons in a grid (h-24 each)
     - Config section skeleton below (h-16)
   - Follow pattern from JobHistorySkeleton.tsx

2. `ResultsDisplay.tsx` (EVAL-10, EVAL-11):
   - Props: `evaluationId: string`
   - Use `useEvaluation(evaluationId)` hook to fetch data
   - Show EvaluationsSkeleton when `isPending`
   - Show error state when `isError`: red border div with error message

   Metrics section (EVAL-10):
   - Create internal `MetricCard` component:
     ```typescript
     function MetricCard({ label, value, format }: {
       label: string
       value: number | undefined
       format: 'percent' | 'decimal'
     }) {
       const displayValue = value !== undefined
         ? format === 'percent'
           ? `${(value * 100).toFixed(1)}%`
           : value.toFixed(3)
         : 'N/A'
       return (
         <div className="rounded-lg border p-4 text-center bg-card">
           <p className="text-sm text-muted-foreground">{label}</p>
           <p className="text-2xl font-bold">{displayValue}</p>
         </div>
       )
     }
     ```
   - Grid of 3 cards: Hit Rate (percent), MRR (decimal), Avg Score (decimal)
   - Data from `data.results_summary`

   Configuration section (EVAL-11):
   - Below metrics grid
   - Display in muted background div:
     - Top-K: `data.retrieve_params.top_k`
     - Query Enhancer: Yes/No based on `data.retrieve_params.use_query_enhancer`
     - Reranking: Yes/No based on `data.retrieve_params.use_reranking`
     - Questions: `data.results_summary?.total_questions ?? 'N/A'`
   - Use flex with gap-4, items wrapped with labels
  </action>
  <verify>
Files exist and TypeScript compiles: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
ResultsDisplay shows 3 metric cards (Hit Rate, MRR, Avg Score) with proper formatting plus configuration section showing top-k, enhancer, reranking, total questions. Loading skeleton matches layout.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Results section to EvaluationPage</name>
  <files>
    frontend/src/features/evaluation/EvaluationPage.tsx
  </files>
  <action>
Update EvaluationPage to add the Results card section (EVAL-09, EVAL-10, EVAL-11):

1. Add imports: EvaluationSelect, ResultsDisplay

2. Add state:
   - `const [selectedEvaluationId, setSelectedEvaluationId] = useState<string | null>(null)`

3. Add new Card after the "Start Evaluation" card:
   ```tsx
   <Card>
     <CardHeader>
       <CardTitle>Results</CardTitle>
       <CardDescription>
         Select an evaluation to view its metrics
       </CardDescription>
     </CardHeader>
     <CardContent className="space-y-4">
       <EvaluationSelect
         value={selectedEvaluationId}
         onChange={setSelectedEvaluationId}
         evaluations={evaluations}
       />
       {selectedEvaluationId && (
         <ResultsDisplay evaluationId={selectedEvaluationId} />
       )}
     </CardContent>
   </Card>
   ```

4. Auto-select newly completed evaluation:
   In the startEvaluation onSuccess callback, also set:
   `setSelectedEvaluationId(data.evaluation_id)`

This creates the flow: User starts evaluation -> evaluation completes -> Results dropdown auto-selects it -> metrics display immediately.
  </action>
  <verify>
Run `cd frontend && npm run dev`, navigate to Evaluation tab, see Results card below Start Evaluation card, dropdown shows completed evaluations (if any), selecting one shows metrics and config.
  </verify>
  <done>
EvaluationPage has Results card with EvaluationSelect dropdown. Selecting an evaluation shows ResultsDisplay with metrics grid (Hit Rate, MRR, Avg Score) and configuration used. New evaluations auto-select after completion.
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `cd frontend && npx tsc --noEmit` passes
2. `cd frontend && npm run dev` starts without errors
3. Navigate to Evaluation tab - see Results section with dropdown
4. Dropdown shows completed evaluations with folder and hit rate preview
5. Selecting evaluation shows 3 metric cards with proper formatting
6. Configuration section shows top-k, enhancer, reranking, total questions
</verification>

<success_criteria>
- EVAL-09: Results dropdown shows completed evaluations
- EVAL-10: Results display shows hit rate (%), MRR (decimal), avg score (decimal)
- EVAL-11: Configuration shown: top-k, query enhancer, reranking, total questions
- EVAL-13 (partial): Loading skeleton shown while fetching evaluation details
</success_criteria>

<output>
After completion, create `.planning/phases/05-evaluation/05-02-SUMMARY.md`
</output>
